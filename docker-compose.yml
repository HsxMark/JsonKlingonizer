version: '3.8'

services:
  libretranslate:
    image: libretranslate/libretranslate:latest
    container_name: libretranslate
    restart: unless-stopped
    ports:
      - "5000:5000"
    volumes:
      # 持久化翻译模型和数据
      - ./libretranslate-data:/home/libretranslate/.local
    environment:
      # 服务器配置
      - LT_HOST=0.0.0.0
      - LT_PORT=5000
      
      # 界面配置
      - LT_DISABLE_WEB_UI=false  # 启用 Web UI
      
      # 模型配置
      - LT_UPDATE_MODELS=true    # 自动更新翻译模型
      
      # 限制配置
      - LT_CHAR_LIMIT=5000       # 单次翻译字符限制
      - LT_REQ_LIMIT=100         # 每分钟请求限制
      - LT_BATCH_LIMIT=10        # 批量翻译限制
      
      # API Key 配置（可选，如需启用请取消注释）
      # - LT_API_KEYS=true
      # - LT_API_KEYS_DB_PATH=/home/libretranslate/.local/api_keys.db
      
      # 前端配置
      - LT_SUGGESTIONS=false     # 禁用改进建议
      - LT_DISABLE_FILES_TRANSLATION=false  # 允许文件翻译
      
    # 健康检查
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5000/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    
    # 资源限制（可选）
    # deploy:
    #   resources:
    #     limits:
    #       cpus: '2'
    #       memory: 4G
    #     reservations:
    #       cpus: '1'
    #       memory: 2G

# 可选：添加 Nginx 反向代理
# nginx:
#   image: nginx:alpine
#   container_name: libretranslate-nginx
#   restart: unless-stopped
#   ports:
#     - "80:80"
#   volumes:
#     - ./nginx.conf:/etc/nginx/nginx.conf:ro
#   depends_on:
#     - libretranslate

volumes:
  libretranslate-data:
    driver: local
